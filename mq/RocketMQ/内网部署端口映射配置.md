
* 10909 : vip 通道端口 | fastListenPort
* 10910 : 
* 10911 : **核心端口** | Broker 对外服务的监听端口 | 非 vip 通道端口 | listenPort
* 10912 : xxx | haListenPort

---

## 映射端口规则

NameServer 的 9876 可以映射为任意的端口，但是 Broker 的 4 个端口需要内外一致。

Broker 的 4 个端口为有序递增的：10909 10910 10911 10912，我们需要在 Broker 的配置文件中指定的是 10911 端口，所以假设按照以下规则映射端口：

* 9876  映射为: 13171
 
* 13172 映射为: 13172
* 13173 映射为: 13173
* 13174 映射为: 13174
* 13175 映射为: 13175

> 共需要映射 5 个端口

那么 10911 对应倒数第二个，即是 13174 端口，所以只需要在 Broker 的配置文件中指定 `listenPort = 13174` 即可。（至于另外三个端口是在代码里面根据配置文件配置的 listenPort 参数执行加减运算得到的，不可以在配置文件中配置!）

同时 Broker 的配置文件中还需要明确指定 Broker 的 IP 为映射出去的公网的 IP，比如：`brokerIP1 = 222.85.230.14`。

但 Broker 的配置文件中指定的 NameServer 的地址和端口可以为内网的 IP 和端口，比如：`namesrvAddr = 192.168.160.11:9876`。 

## 开始配置

先将 NameServer 的 9876 端口映射为 13171。

然后在 Broker 的配置文件中指定 brokerIP1 为映射出去的公网 IP，同时指定端口为 13174，NameServer 的地址和端口使用内网 IP 和端口：

```
brokerIP1 = 222.85.230.14
listenPort = 13174
namesrvAddr = 192.168.160.11:9876
```

broker 监听的所有端口都需要和映射出去的一样，即监听 13174，则该端口映射出去的端口也是 13174，broker 还会监听另外几个端口，同样的都是本地监听和映射的端口相同即可。
